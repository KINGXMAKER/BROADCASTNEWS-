<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BBO DROP ZONE | Broadcast Engagement</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#080808">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { 
            theme: { 
                extend: { 
                    colors: { 
                        bbo: '#FF1493', 
                        'bbo-light': '#FF69B4',
                        black: '#080808',
                        panel: '#111111'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    }
                } 
            } 
        }
    </script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: #080808;
            color: #ffffff;
            background-image: radial-gradient(circle at 50% 0%, rgba(255, 20, 147, 0.08) 0%, transparent 50%);
            overscroll-behavior: none;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .glass-panel {
            background: rgba(17, 17, 17, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Drag & Drop Styles */
        .drop-zone {
            border: 2px dashed rgba(255, 20, 147, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .drop-zone.dragover {
            border-color: #FF1493;
            background: rgba(255, 20, 147, 0.05);
            transform: scale(1.02);
            box-shadow: 0 0 30px rgba(255, 20, 147, 0.2);
        }

        /* Glowing Button */
        .glow-btn {
            background: linear-gradient(135deg, #FF1493, #FF69B4);
            box-shadow: 0 4px 15px rgba(255, 20, 147, 0.3), inset 0 -2px 0 rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        
        .glow-btn:hover {
            box-shadow: 0 6px 25px rgba(255, 20, 147, 0.5), inset 0 -2px 0 rgba(0,0,0,0.2);
            transform: translateY(-2px);
        }
        
        .glow-btn:active {
            transform: translateY(1px);
            box-shadow: 0 2px 10px rgba(255, 20, 147, 0.3);
        }

        .spinner {
            border: 3px solid rgba(255, 20, 147, 0.2);
            border-top-color: #FF1493;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-slide {
            animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            z-index: 1000;
            pointer-events: none;
        }
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col font-sans">

    <!-- Navbar -->
    <nav class="sticky top-0 z-40 glass-panel border-b border-white/10 px-6 py-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 rounded-full bg-bbo flex items-center justify-center font-black text-white text-xs tracking-tighter shadow-[0_0_15px_rgba(255,20,147,0.5)]">
                BBO
            </div>
            <div>
                <h1 class="text-lg font-black tracking-tight leading-none text-white">DROP <span class="text-transparent bg-clip-text bg-gradient-to-r from-bbo to-bbo-light">ZONE</span></h1>
            </div>
        </div>
        <button onclick="openSettings()" class="text-gray-400 hover:text-white transition-colors">
            <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>
    </nav>

    <!-- Main App Area -->
    <main class="flex-1 flex flex-col lg:flex-row w-full max-w-7xl mx-auto p-4 lg:p-8 gap-6">
        
        <!-- Left: Upload & Input Panel -->
        <div class="w-full lg:w-5/12 flex flex-col gap-5">
            
            <div class="glass-panel rounded-2xl p-5 border border-gray-800">
                <h2 class="text-sm font-bold text-gray-300 uppercase tracking-widest mb-4">1. Drop Content</h2>
                
                <!-- Drag & Drop Area -->
                <div id="dropZone" onclick="document.getElementById('fileInput').click()" class="drop-zone w-full h-56 rounded-xl bg-black/50 flex flex-col items-center justify-center cursor-pointer relative overflow-hidden group">
                    <input type="file" id="fileInput" class="hidden" accept="image/*,video/mp4,video/webm,video/quicktime">
                    
                    <!-- Empty State -->
                    <div id="dropPlaceholder" class="flex flex-col items-center justify-center text-center p-6 z-10">
                        <div class="w-14 h-14 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center mb-3 group-hover:border-bbo transition-colors duration-300">
                            <span class="text-2xl">üì∏</span>
                        </div>
                        <p class="font-bold text-white text-sm mb-1">Drag & Drop Media</p>
                        <p class="text-xs text-gray-500 font-medium">Screenshots ‚Ä¢ Memes ‚Ä¢ Twitter Videos</p>
                    </div>

                    <!-- Preview State -->
                    <div id="previewContainer" class="hidden absolute inset-0 w-full h-full bg-black z-20">
                        <img id="imagePreview" class="w-full h-full object-contain hidden" />
                        <video id="videoPreview" class="w-full h-full object-contain hidden" controls></video>
                        <button onclick="clearMedia(event)" class="absolute top-3 right-3 w-8 h-8 rounded-full bg-black/80 backdrop-blur border border-white/20 flex items-center justify-center text-white hover:bg-bbo hover:border-bbo transition z-30">
                            ‚úï
                        </button>
                    </div>
                </div>

                <div class="mt-5">
                    <label class="text-xs font-bold text-gray-500 uppercase tracking-widest block mb-2">Or add context (Twitter Links / Text)</label>
                    <textarea id="contextInput" rows="3" class="w-full bg-black border border-gray-800 rounded-xl p-3.5 text-white text-sm focus:outline-none focus:border-bbo focus:ring-1 focus:ring-bbo transition placeholder-gray-700 resize-none no-scrollbar font-medium" placeholder="Paste the tweet URL here, or describe the drama..."></textarea>
                </div>

                <button id="generateBtn" onclick="generateContent()" class="glow-btn w-full mt-5 py-4 rounded-xl text-white font-black text-sm tracking-wide flex justify-center items-center gap-2">
                    <span>‚ö° HYPE THIS UP</span>
                </button>
            </div>
            
            <div class="text-center px-4">
                <p class="text-[10px] uppercase tracking-widest font-bold text-gray-600">The AI reads the image/video to generate hyper-specific broadcast polls.</p>
            </div>
        </div>

        <!-- Right: Results Panel -->
        <div class="w-full lg:w-7/12 flex flex-col">
            <div class="glass-panel rounded-2xl border border-gray-800 flex-1 flex flex-col relative overflow-hidden h-[600px]">
                
                <!-- Fixed Header for Results -->
                <div class="px-6 py-4 border-b border-gray-800 bg-panel/50 backdrop-blur z-10 flex justify-between items-center">
                    <h2 class="text-sm font-bold text-gray-300 uppercase tracking-widest">2. Broadcast Ammo</h2>
                    <span id="resultCount" class="text-xs font-mono font-bold text-bbo bg-bbo/10 px-2 py-0.5 rounded">0 POSTS</span>
                </div>

                <!-- Scrollable Results Content -->
                <div id="resultsContainer" class="flex-1 overflow-y-auto no-scrollbar p-6 space-y-4 relative">
                    
                    <!-- Empty State -->
                    <div id="resultsEmpty" class="absolute inset-0 flex flex-col items-center justify-center text-center p-8">
                        <div class="w-16 h-16 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center mb-4 text-3xl">
                            üì°
                        </div>
                        <h3 class="text-white font-bold text-lg mb-1">Waiting for drops...</h3>
                        <p class="text-sm text-gray-500 font-medium max-w-xs">Drop media on the left, and the engine will cook up engaging polls, questions, and takes for your channel.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="resultsLoading" class="hidden absolute inset-0 bg-panel/90 backdrop-blur-sm flex flex-col items-center justify-center z-20">
                        <div class="spinner mb-4"></div>
                        <p class="text-bbo font-bold text-xs tracking-widest uppercase animate-pulse">Analyzing Culture...</p>
                    </div>

                    <!-- Generated Content injected here -->
                </div>
            </div>
        </div>

    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="hidden fixed inset-0 z-50 bg-black/95 backdrop-blur-md flex items-center justify-center p-5 opacity-0 transition-opacity duration-300">
        <div class="w-full max-w-md bg-panel rounded-2xl p-7 border border-gray-800 transform scale-95 transition-transform duration-300" id="settingsBox">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                    <svg class="w-5 h-5 text-bbo" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                    Engine Settings
                </h3>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2">Gemini API Key</label>
                    <input type="password" id="apiKeyInput" class="w-full bg-black border border-gray-800 rounded-xl p-4 text-white text-sm focus:outline-none focus:border-bbo focus:shadow-[0_0_15px_rgba(255,20,147,0.2)] transition font-mono" placeholder="AI Studio Key...">
                    <p class="text-xs text-gray-500 mt-2 font-medium">Powering the visual analysis. <a href="https://aistudio.google.com/apikey" target="_blank" class="text-bbo hover:text-bbo-light transition">Get a free key</a></p>
                </div>
                
                <div class="pt-2 flex gap-3">
                    <button onclick="closeSettings()" class="flex-1 py-3.5 bg-gray-900 border border-gray-800 text-white font-bold rounded-xl hover:bg-gray-800 transition text-sm">Cancel</button>
                    <button onclick="saveSettings()" class="flex-1 py-3.5 bg-white text-black font-black rounded-xl hover:bg-gray-200 transition text-sm shadow-[0_0_15px_rgba(255,255,255,0.2)]">SAVE KEY</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast class=bg-panel border border-gray-800 rounded-full px-6 py-3 text-sm font-bold flex items-center gap-3 shadow-[0_10px_40px_rgba(0,0,0,0.8)] glass-panel">
        <span id="toastIcon" class="text-lg">üìã</span>
        <span id="toastMsg" class="text-white">Copied to clipboard!</span>
    </div>

    <script>
        // --- STATE & INITIALIZATION ---
        let currentMedia = { dataBase64: null, mimeType: null };
        const systemPrompt = `You are the content engine for BBO (Bad Bitches Only), an urban lifestyle brand run by King Maker. I am dropping a piece of urban media (image, video, or context text) into my Instagram Broadcast Channel. 
        
        Analyze the provided image, video, or text deeply. Figure out what the drama or topic is. 
        Then, generate 4 different broadcast channel messages to drop alongside this media to GET PEOPLE TICKING AND VOTING.

        Format requirements for the 4 outputs:
        1. A spicy 2-Button Poll (A/B)
        2. A "BBO Court" (Guilty/Not Guilty) scenario based on the media
        3. A "Finish the line" related to the content
        4. A polarizing hot take + "Agree or Disagree"

        RULES:
        - NEVER ask open-ended questions. Only give tap options.
        - Tone: confident, urban, unapologetic, baddie energy, polarizing.
        - Keep EACH post under 3-4 lines MAX.
        - Return each post separated by the exact string "===POST===" on its own line.
        - Do not number them or add format labels. Just the raw text ready to copy-paste.`;

        window.onload = () => {
            const key = localStorage.getItem('bbo_gemini_key');
            if (key) document.getElementById('apiKeyInput').value = key;
            else openSettings();
        };

        // --- DRAG AND DROP LOGIC ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
            document.body.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('dragover'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('dragover'), false);
        });

        dropZone.addEventListener('drop', (e) => {
            const dt = e.dataTransfer;
            const files = dt.files;
            if (files.length) handleFile(files[0]);
        });

        fileInput.addEventListener('change', function() {
            if (this.files.length) handleFile(this.files[0]);
        });

        function handleFile(file) {
            const validImageTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/heic'];
            const validVideoTypes = ['video/mp4', 'video/webm', 'video/quicktime'];
            
            if (!validImageTypes.includes(file.type) && !validVideoTypes.includes(file.type)) {
                return showToast('Please drop an image or MP4 video', true);
            }

            const isVideo = validVideoTypes.includes(file.type);
            const reader = new FileReader();
            
            reader.onload = (e) => {
                const base64Str = e.target.result.split(',')[1];
                currentMedia = { dataBase64: base64Str, mimeType: file.type };
                
                // UI Updates
                document.getElementById('dropPlaceholder').classList.add('hidden');
                document.getElementById('previewContainer').classList.remove('hidden');
                
                const imgPreview = document.getElementById('imagePreview');
                const vidPreview = document.getElementById('videoPreview');
                
                if (isVideo) {
                    imgPreview.classList.add('hidden');
                    vidPreview.classList.remove('hidden');
                    vidPreview.src = e.target.result;
                } else {
                    vidPreview.classList.add('hidden');
                    imgPreview.classList.remove('hidden');
                    imgPreview.src = e.target.result;
                }
            };
            
            reader.readAsDataURL(file);
        }

        function clearMedia(e) {
            if(e) e.stopPropagation();
            currentMedia = { dataBase64: null, mimeType: null };
            fileInput.value = '';
            document.getElementById('previewContainer').classList.add('hidden');
            document.getElementById('dropPlaceholder').classList.remove('hidden');
            document.getElementById('imagePreview').src = '';
            document.getElementById('videoPreview').src = '';
        }

        // --- API INTEGRATION ---
        async function generateContent() {
            const apiKey = localStorage.getItem('bbo_gemini_key');
            if (!apiKey) return openSettings();

            const contextText = document.getElementById('contextInput').value.trim();
            
            if (!currentMedia.dataBase64 && !contextText) {
                return showToast('Drop an image/video or paste some text first!', true);
            }

            // Setup UI for Loading
            document.getElementById('resultsEmpty').classList.add('hidden');
            const resultsContainer = document.getElementById('resultsContainer');
            const loadingOverlay = document.getElementById('resultsLoading');
            loadingOverlay.classList.remove('hidden');
            
            // Build Gemini Payload
            // Note using Gemini 1.5 Flash as it handles inline images/video well
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            
            let parts = [{ text: systemPrompt }];
            
            if (currentMedia.dataBase64) {
                parts.push({
                    inlineData: {
                        mimeType: currentMedia.mimeType,
                        data: currentMedia.dataBase64
                    }
                });
            }
            
            if (contextText) {
                parts.push({ text: `Additional context or link from user: ${contextText}` });
            }

            const requestBody = {
                contents: [{ parts: parts }],
                generationConfig: { temperature: 1.1 },
                tools: [{ googleSearch: {} }] // Allow it to search if a link is dropped
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    const errorData = await response.text();
                    throw new Error(errorData.includes('API key') ? 'Invalid API Key' : 'File might be too large or API error');
                }

                const data = await response.json();
                const text = data.candidates[0].content.parts[0].text;
                
                // Parse Posts
                const posts = text.split('===POST===')
                                  .map(p => p.trim())
                                  .filter(p => p.length > 5);
                
                renderResults(posts);
                
            } catch (err) {
                console.error(err);
                showToast('‚ùå ' + err.message, true);
                if(resultsContainer.children.length <= 2) {
                    document.getElementById('resultsEmpty').classList.remove('hidden');
                }
            } finally {
                loadingOverlay.classList.add('hidden');
            }
        }

        function renderResults(posts) {
            const container = document.getElementById('resultsContainer');
            
            // Remove old generated posts, keep empty/loading states
            Array.from(container.children).forEach(child => {
                if(child.id !== 'resultsEmpty' && child.id !== 'resultsLoading') {
                    child.remove();
                }
            });

            document.getElementById('resultCount').textContent = `${posts.length} READY`;

            posts.forEach((post, index) => {
                const safePostText = post.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\n/g, '<br>');
                const rawTextEncoded = encodeURIComponent(post); // for safely passing to copy function
                
                const card = document.createElement('div');
                card.className = `glass-panel rounded-xl p-5 border border-gray-800 animate-slide bg-black/40 hover:bg-black/60 transition-colors`;
                card.style.animationDelay = `${index * 0.1}s`;
                
                card.innerHTML = `
                    <div class="flex items-start gap-4">
                        <div class="w-8 h-8 rounded-full bg-gray-900 border border-gray-800 flex items-center justify-center shrink-0 font-mono text-xs font-bold text-gray-400">
                            0${index + 1}
                        </div>
                        <div class="flex-1">
                            <p class="text-white text-sm leading-relaxed font-medium font-sans mb-4">${safePostText}</p>
                            <button onclick="copyToClipboard(this, decodeURIComponent('${rawTextEncoded}'))" class="py-2.5 px-4 rounded-lg bg-gray-900 border border-gray-800 hover:border-bbo hover:text-bbo text-gray-300 text-xs font-bold transition flex items-center justify-center gap-2 w-full sm:w-auto">
                                üìã COPY TEXT
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function copyToClipboard(btn, text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalHtml = btn.innerHTML;
                btn.innerHTML = '‚úÖ COPIED!';
                btn.classList.add('bg-bbo/10', 'border-bbo', 'text-bbo');
                showToast('Ready for Broadcast üì°');
                
                setTimeout(() => {
                    btn.innerHTML = originalHtml;
                    btn.classList.remove('bg-bbo/10', 'border-bbo', 'text-bbo');
                }, 2000);
            });
        }

        // --- UI UTILS ---
        const settingsModal = document.getElementById('settingsModal');
        const settingsBox = document.getElementById('settingsBox');

        function openSettings() {
            settingsModal.classList.remove('hidden');
            setTimeout(() => {
                settingsModal.classList.remove('opacity-0');
                settingsBox.classList.remove('scale-95');
            }, 10);
        }

        function closeSettings() {
            settingsModal.classList.add('opacity-0');
            settingsBox.classList.add('scale-95');
            setTimeout(() => {
                settingsModal.classList.add('hidden');
            }, 300);
        }

        function saveSettings() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (!key) return showToast('API Key is required', true);
            localStorage.setItem('bbo_gemini_key', key);
            closeSettings();
            showToast('Engine Ready ‚ö°');
        }

        function showToast(msg, isError = false) {
            const toast = document.getElementById('toast');
            document.getElementById('toastIcon').textContent = isError ? '‚ùå' : 'üìã';
            document.getElementById('toastMsg').textContent = msg;
            
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }
    </script>
</body>
</html>
